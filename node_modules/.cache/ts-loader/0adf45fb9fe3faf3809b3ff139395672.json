{"remainingRequest":"/Users/dduru/VSCode/OmarzeUI/node_modules/babel-loader/lib/index.js!/Users/dduru/VSCode/OmarzeUI/node_modules/ts-loader/index.js??ref--13-2!/Users/dduru/VSCode/OmarzeUI/src/components/auth/UserAuthContext.ts","dependencies":[{"path":"/Users/dduru/VSCode/OmarzeUI/src/components/auth/UserAuthContext.ts","mtime":1594761596640},{"path":"/Users/dduru/VSCode/OmarzeUI/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/dduru/VSCode/OmarzeUI/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/dduru/VSCode/OmarzeUI/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubWF0Y2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3ViIjsKaW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9Vc2Vycy9kZHVydS9WU0NvZGUvT21hcnplVUkvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9Vc2Vycy9kZHVydS9WU0NvZGUvT21hcnplVUkvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMvZGR1cnUvVlNDb2RlL09tYXJ6ZVVJL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCB7IExvZywgQ29uc3RhbnRzIH0gZnJvbSAnLi4vdXRpbCc7CmltcG9ydCBkZXNjcmlwdG9ycyBmcm9tICdAL2NvbXBvbmVudHMvYXV0aC9kZXNjcmlwdG9ycyc7Ci8qKgogKiBVc2VyQXV0aENvbnRleHQgY2xhc3MgZW5jYXBzdWxhdGVzIGFsbCB0aGUgaW5mb3JtYXRpb24ga25vd24gYWJvdXQKICogYSB1c2VyIG9uIHN1Y2Nlc3NmdWwgYXV0aG9yaXNhdGlvbi4uCiAqLwoKdmFyIFVzZXJBdXRoQ29udGV4dCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gVXNlckF1dGhDb250ZXh0KCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFVzZXJBdXRoQ29udGV4dCk7CgogICAgdGhpcy51c2VybmFtZSA9ICcnOwogICAgdGhpcy5hdXRob3JpemF0aW9ucyA9IFtdOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFVzZXJBdXRoQ29udGV4dCwgW3sKICAgIGtleTogImluaXRpYWxpemUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRpYWxpemUodG9rZW4pIHsKICAgICAgdmFyIHRva2VuTWF0Y2ggPSB0b2tlbi5tYXRjaChDb25zdGFudHMucmVnZXhwcy5BVVRIX1RPS0VOKTsKCiAgICAgIGlmICh0b2tlbk1hdGNoID09PSBudWxsKSB7CiAgICAgICAgTG9nLmVycm9yKCdVbmFibGUgdG8gRXh0cmFjdCBUb2tlbiBQYXlsb2FkJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnByb2Nlc3NUb2tlblBheWxvYWQodG9rZW5NYXRjaFsxXSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaG9tZVVybCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaG9tZVVybCgpIHsKICAgICAgdmFyIGF1dGhDb250ZXh0ID0gdGhpcy5hdXRoQ29udGV4dCgpOwoKICAgICAgaWYgKGF1dGhDb250ZXh0ID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CgogICAgICByZXR1cm4gYXV0aENvbnRleHQuaG9tZVVybDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJhdXRoQ29udGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYXV0aENvbnRleHQoKSB7CiAgICAgIHZhciBjb250ZXh0RGVzY3JpcHRvciA9IG51bGw7CgogICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoZGVzY3JpcHRvcnMpLAogICAgICAgICAgX3N0ZXA7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgZGVzY3JpcHRvciA9IF9zdGVwLnZhbHVlOwoKICAgICAgICAgIGlmICh0aGlzLmhhc0F1dGhvcml6YXRpb24oZGVzY3JpcHRvci5uYW1lKSkgewogICAgICAgICAgICBjb250ZXh0RGVzY3JpcHRvciA9IGRlc2NyaXB0b3I7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBjb250ZXh0RGVzY3JpcHRvcjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJoYXNBdXRob3JpemF0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNBdXRob3JpemF0aW9uKGF1dGhvcml6YXRpb24pIHsKICAgICAgcmV0dXJuIHRoaXMuYXV0aG9yaXphdGlvbnMubGVuZ3RoID4gMCAmJiB0aGlzLmF1dGhvcml6YXRpb25zLmluZGV4T2YoYXV0aG9yaXphdGlvbikgPiAtMTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwcm9jZXNzVG9rZW5QYXlsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwcm9jZXNzVG9rZW5QYXlsb2FkKHBheWxvYWQpIHsKICAgICAgcGF5bG9hZCA9IGF0b2IocGF5bG9hZCk7CiAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShwYXlsb2FkKTsKICAgICAgdGhpcy51c2VybmFtZSA9IGRhdGEuc3ViOwogICAgICB0aGlzLmF1dGhvcml6YXRpb25zID0gZGF0YS5hdXRob3JpemF0aW9uczsKICAgIH0KICB9XSwgW3sKICAgIGtleTogImdldEluc3RhbmNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJbnN0YW5jZSgpIHsKICAgICAgaWYgKFVzZXJBdXRoQ29udGV4dC5pbnN0YW5jZSA9PT0gbnVsbCkgewogICAgICAgIExvZy5pbmZvKCdDcmVhdGluZyBOZXcgVXNlckF1dGhDb250ZXh0IGluc3RhbmNlJyk7CiAgICAgICAgVXNlckF1dGhDb250ZXh0Lmluc3RhbmNlID0gbmV3IFVzZXJBdXRoQ29udGV4dCgpOwogICAgICB9CgogICAgICByZXR1cm4gVXNlckF1dGhDb250ZXh0Lmluc3RhbmNlOwogICAgfQogIH0sIHsKICAgIGtleTogImRlc3Ryb3kiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgIGRlbGV0ZSBVc2VyQXV0aENvbnRleHQuaW5zdGFuY2U7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gVXNlckF1dGhDb250ZXh0Owp9KCk7CgpleHBvcnQgeyBVc2VyQXV0aENvbnRleHQgYXMgZGVmYXVsdCB9OwpVc2VyQXV0aENvbnRleHQuaW5zdGFuY2UgPSBudWxsOw=="},{"version":3,"sources":["/Users/dduru/VSCode/OmarzeUI/src/components/auth/UserAuthContext.ts"],"names":[],"mappings":";;;;;;;;AAAA,SAAS,GAAT,EAAc,SAAd,QAA+B,SAA/B;AAEA,OAAO,WAAP,MAAwB,+BAAxB;AAGA;;;;;IAIqB,e;AAArB,6BAAA;AAAA;;AAoBY,SAAA,QAAA,GAAmB,EAAnB;AAGA,SAAA,cAAA,GAA2B,EAA3B;AAkDX;;;;+BA/CqB,K,EAAa;AAC3B,UAAM,UAAU,GAAG,KAAK,CAAC,KAAN,CAAY,SAAS,CAAC,OAAV,CAAkB,UAA9B,CAAnB;;AACA,UAAI,UAAU,KAAK,IAAnB,EAAyB;AACrB,QAAA,GAAG,CAAC,KAAJ,CAAU,iCAAV;AACA;AACH;;AAED,WAAK,mBAAL,CAAyB,UAAU,CAAC,CAAD,CAAnC;AACH;;;8BAGa;AACV,UAAM,WAAW,GAAG,KAAK,WAAL,EAApB;;AACA,UAAI,WAAW,KAAK,IAApB,EAA0B;AACtB,eAAO,EAAP;AACH;;AAED,aAAO,WAAW,CAAC,OAAnB;AACH;;;kCAGiB;AACd,UAAI,iBAAiB,GAAiC,IAAtD;;AADc,iDAGW,WAHX;AAAA;;AAAA;AAGd,4DAAsC;AAAA,cAA3B,UAA2B;;AAClC,cAAI,KAAK,gBAAL,CAAsB,UAAU,CAAC,IAAjC,CAAJ,EAA4C;AACxC,YAAA,iBAAiB,GAAG,UAApB;AACH;AACJ;AAPa;AAAA;AAAA;AAAA;AAAA;;AASd,aAAO,iBAAP;AACH;;;qCAGuB,a,EAAqB;AACzC,aAAQ,KAAK,cAAL,CAAoB,MAApB,GAA6B,CAA9B,IAAqC,KAAK,cAAL,CAAoB,OAApB,CAA4B,aAA5B,IAA6C,CAAC,CAA1F;AACH;;;wCAG2B,O,EAAe;AACvC,MAAA,OAAO,GAAG,IAAI,CAAC,OAAD,CAAd;AACA,UAAM,IAAI,GAAG,IAAI,CAAC,KAAL,CAAW,OAAX,CAAb;AAEA,WAAK,QAAL,GAAgB,IAAI,CAAC,GAArB;AACA,WAAK,cAAL,GAAsB,IAAI,CAAC,cAA3B;AACH;;;kCAlEwB;AACrB,UAAI,eAAe,CAAC,QAAhB,KAA6B,IAAjC,EAAuC;AACnC,QAAA,GAAG,CAAC,IAAJ,CAAS,uCAAT;AACA,QAAA,eAAe,CAAC,QAAhB,GAA2B,IAAI,eAAJ,EAA3B;AACH;;AAED,aAAO,eAAe,CAAC,QAAvB;AACH;;;8BAGoB;AACjB,aAAO,eAAe,CAAC,QAAvB;AACH;;;;;;SAjBgB,e;AAEH,eAAA,CAAA,QAAA,GAAmC,IAAnC","sourcesContent":["import { Log, Constants } from '../util';\nimport AuthContextDescriptor from './descriptors/AuthContextDescriptor';\nimport descriptors from '@/components/auth/descriptors';\n\n\n/**\n * UserAuthContext class encapsulates all the information known about \n * a user on successful authorisation.. \n */\nexport default class UserAuthContext {\n\n    public static instance: UserAuthContext | null = null;\n\n\n    public static getInstance(): UserAuthContext {\n        if (UserAuthContext.instance === null) {\n            Log.info('Creating New UserAuthContext instance');\n            UserAuthContext.instance = new UserAuthContext();\n        }\n\n        return UserAuthContext.instance;\n    }\n\n\n    public static destroy() {\n        delete UserAuthContext.instance;\n    }\n\n\n    private username: string = '';\n\n\n    private authorizations: string[] = [];\n\n\n    public initialize(token: string) {\n        const tokenMatch = token.match(Constants.regexps.AUTH_TOKEN);\n        if (tokenMatch === null) {\n            Log.error('Unable to Extract Token Payload');\n            return;\n        }\n\n        this.processTokenPayload(tokenMatch[1]);\n    }\n\n\n    public homeUrl(): string {\n        const authContext = this.authContext();\n        if (authContext === null) {\n            return '';\n        }\n\n        return authContext.homeUrl;\n    }\n\n\n    public authContext(): AuthContextDescriptor | null {\n        let contextDescriptor: AuthContextDescriptor | null = null;\n\n        for (const descriptor of descriptors) {\n            if (this.hasAuthorization(descriptor.name)) {\n                contextDescriptor = descriptor;\n            }\n        }\n\n        return contextDescriptor;\n    }\n\n\n    public hasAuthorization(authorization: string): boolean {\n        return (this.authorizations.length > 0) && (this.authorizations.indexOf(authorization) > -1);\n    }\n\n\n    private processTokenPayload(payload: string) {\n        payload = atob(payload);\n        const data = JSON.parse(payload);\n\n        this.username = data.sub;\n        this.authorizations = data.authorizations;\n    }\n\n}\n\n\n"],"sourceRoot":""}]}